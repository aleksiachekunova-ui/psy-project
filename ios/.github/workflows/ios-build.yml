name: iOS Build Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch: # ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ

jobs:
  build:
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ñ‚Ð¾ÐºÐµÐ½ Ð´Ð»Ñ Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ñ… Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸ÐµÐ² (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶ÐµÐ½)
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
    
    - name: Select Xcode version
      run: |
        # ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð²Ñ‹Ð±Ð¸Ñ€Ð°ÐµÑ‚ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð²ÐµÑ€ÑÐ¸ÑŽ Xcode
        sudo xcode-select -s /Applications/Xcode.app/Contents/Developer
    
    - name: Show Xcode version
      run: xcodebuild -version
    
    - name: List available simulators
      run: xcrun simctl list devices available
    
    - name: Build iOS project
      run: |
        # Ð˜Ñ‰ÐµÐ¼ .xcodeproj Ð¸Ð»Ð¸ .xcworkspace
        if [ -f "FillYourCup.xcodeproj/project.pbxproj" ]; then
          echo "âœ… ÐÐ°Ð¹Ð´ÐµÐ½ .xcodeproj Ñ„Ð°Ð¹Ð»"
          xcodebuild -project FillYourCup.xcodeproj \
            -scheme FillYourCup \
            -sdk iphonesimulator \
            -destination 'platform=iOS Simulator,name=iPhone 15' \
            -configuration Debug \
            clean build || exit 1
        elif [ -f "ios/FillYourCup.xcodeproj/project.pbxproj" ]; then
          echo "âœ… ÐÐ°Ð¹Ð´ÐµÐ½ .xcodeproj Ñ„Ð°Ð¹Ð» Ð² Ð¿Ð°Ð¿ÐºÐµ ios/"
          cd ios
          xcodebuild -project FillYourCup.xcodeproj \
            -scheme FillYourCup \
            -sdk iphonesimulator \
            -destination 'platform=iOS Simulator,name=iPhone 15' \
            -configuration Debug \
            clean build || exit 1
        elif [ -f "FillYourCup.xcworkspace/contents.xcworkspacedata" ]; then
          echo "âœ… ÐÐ°Ð¹Ð´ÐµÐ½ .xcworkspace Ñ„Ð°Ð¹Ð»"
          xcodebuild -workspace FillYourCup.xcworkspace \
            -scheme FillYourCup \
            -sdk iphonesimulator \
            -destination 'platform=iOS Simulator,name=iPhone 15' \
            -configuration Debug \
            clean build || exit 1
        else
          echo "âš ï¸ ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½ .xcodeproj Ð¸Ð»Ð¸ .xcworkspace Ñ„Ð°Ð¹Ð»"
          echo "ðŸ“ Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸:"
          ls -la
          echo ""
          echo "ðŸ’¡ Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Xcode Ð¿Ñ€Ð¾ÐµÐºÑ‚:"
          echo "   1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Xcode"
          echo "   2. File â†’ New â†’ Project â†’ iOS â†’ App"
          echo "   3. ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ: FillYourCup"
          echo "   4. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð²ÑÐµ Swift Ñ„Ð°Ð¹Ð»Ñ‹ Ð¸Ð· Ð¿Ð°Ð¿ÐºÐ¸ FillYourCup/"
          echo ""
          echo "ðŸ“– Ð˜Ð»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Swift Package Manager Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸ÑÐ°:"
          swift --version || echo "Swift Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½"
          exit 1
        fi
      
    - name: Run tests (if available)
      continue-on-error: true
      run: |
        if [ -f "FillYourCup.xcodeproj/project.pbxproj" ]; then
          xcodebuild test -project FillYourCup.xcodeproj \
            -scheme FillYourCup \
            -sdk iphonesimulator \
            -destination 'platform=iOS Simulator,name=iPhone 15' || true
        elif [ -f "FillYourCup.xcworkspace/contents.xcworkspacedata" ]; then
          xcodebuild test -workspace FillYourCup.xcworkspace \
            -scheme FillYourCup \
            -sdk iphonesimulator \
            -destination 'platform=iOS Simulator,name=iPhone 15' || true
        fi
    
    - name: Build summary
      if: always()
      run: |
        echo "## âœ… Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°" >> $GITHUB_STEP_SUMMARY
        echo "- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: ${{ job.status }}" >> $GITHUB_STEP_SUMMARY
        echo "- Ð’ÐµÑ€ÑÐ¸Ñ Xcode: $(xcodebuild -version | head -n 1)" >> $GITHUB_STEP_SUMMARY

